<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BudgetManager.Views.BudgetDetailsPage"
             xmlns:vm="clr-namespace:BudgetManager.ViewModels"
             Title="{Binding Title}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Edit" Command="{Binding EditBudgetCommand}" Order="Primary" Priority="0" IconImageSource="edit.png" />
        <ToolbarItem Text="Delete" Command="{Binding DeleteBudgetCommand}" Order="Primary" Priority="1" IconImageSource="delete.png" />
    </ContentPage.ToolbarItems>

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="Primary">#2196F3</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Style="{StaticResource PageBody}" RowDefinitions="Auto,*">
        <!-- Header / Summary -->
        <Frame Grid.Row="0" Margin="15" Padding="15" BackgroundColor="{StaticResource Primary}" CornerRadius="10" HasShadow="True">
            <VerticalStackLayout Spacing="5">
                <Label Text="{Binding CurrentBudget.Name}" TextColor="White" FontSize="20" FontAttributes="Bold"/>
                <HorizontalStackLayout Spacing="10">
                    <Label Text="Total:" TextColor="#E3F2FD" FontSize="14"/>
                    <Label Text="{Binding CurrentBudget.Amount, StringFormat='৳ {0:F2}'}" TextColor="White" FontAttributes="Bold" FontSize="14"/>
                </HorizontalStackLayout>
                <HorizontalStackLayout Spacing="10">
                    <Label Text="Expenses:" TextColor="#E3F2FD" FontSize="14"/>
                    <Label Text="{Binding CurrentBudget.FormattedSpent}" TextColor="White" FontAttributes="Bold" FontSize="14"/>
                </HorizontalStackLayout>
                 <HorizontalStackLayout Spacing="10">
                    <Label Text="Remaining:" TextColor="#E3F2FD" FontSize="14"/>
                    <Label Text="{Binding CurrentBudget.FormattedRemaining}" TextColor="White" FontAttributes="Bold" FontSize="14"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Frame>

        <!-- Costs List -->
        <CollectionView Grid.Row="1" ItemsSource="{Binding Costs}" Margin="15,0,15,0">
            <CollectionView.EmptyView>
                <Label Text="No costs found for this budget."
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                     <Border Margin="0,5" Padding="10" StrokeThickness="0" BackgroundColor="#F5F5F5">
                         <Border.StrokeShape>
                             <RoundRectangle CornerRadius="8"/>
                         </Border.StrokeShape>
                         <Grid ColumnDefinitions="*, Auto" RowDefinitions="Auto, Auto">
                             <Label Grid.Row="0" Grid.Column="0" Text="{Binding CategoryName}" FontAttributes="Bold" TextColor="Black"/>
                             <Label Grid.Row="0" Grid.Column="1" Text="{Binding Amount, StringFormat='- ৳ {0:F2}'}" TextColor="Red" FontAttributes="Bold"/>
                             
                             <Label Grid.Row="1" Grid.Column="0" Text="{Binding DisplayDate}" FontSize="12" TextColor="Gray"/>
                             <Label Grid.Row="1" Grid.Column="1" Text="{Binding Note}" FontSize="12" TextColor="Gray" HorizontalOptions="End" LineBreakMode="TailTruncation"/>
                         </Grid>
                     </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>
