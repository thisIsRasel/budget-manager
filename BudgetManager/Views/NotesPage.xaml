<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BudgetManager.ViewModels"
             xmlns:models="clr-namespace:BudgetManager.Models"
             x:Class="BudgetManager.Views.NotesPage"
             x:DataType="vm:NotesViewModel"
             Title="Notes">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Add" Command="{Binding AddNoteCommand}">
            <ToolbarItem.IconImageSource>
                <FontImageSource
                    FontFamily="fa-solid"
                    Glyph="&#xf067;"
                    Size="16" />
            </ToolbarItem.IconImageSource>
        </ToolbarItem>
    </ContentPage.ToolbarItems>

    <Grid Style="{StaticResource PageBody}" RowDefinitions="Auto, *" Padding="12">

        <CollectionView Grid.Row="1" ItemsSource="{Binding Notes}" SelectionMode="None">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Note">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Delete"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type vm:NotesViewModel}}, Path=DeleteNoteCommand}"
                                           CommandParameter="{Binding .}"
                                           BackgroundColor="#FF5252"/>
                            </SwipeItems>
                        </SwipeView.RightItems>
                        <Frame CornerRadius="8" 
                               BackgroundColor="{StaticResource Surface}"
                               BorderColor="Transparent"
                               HasShadow="True"
                               Padding="15">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:NotesViewModel}}, Path=EditNoteCommand}"
                                                      CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>
                            <VerticalStackLayout Spacing="5">
                                <Label Text="{Binding Title}" 
                                       FontSize="18" 
                                       FontAttributes="Bold" 
                                       TextColor="{StaticResource TextPrimary}"
                                       LineBreakMode="TailTruncation"/>
                                <Label Text="{Binding Text}" 
                                       FontSize="14" 
                                       TextColor="{StaticResource TextSecondary}" 
                                       MaxLines="2" 
                                       LineBreakMode="TailTruncation"/>
                                <Label Text="{Binding Date, StringFormat='{0:MMM dd, yyyy}'}" 
                                       FontSize="12" 
                                       TextColor="{StaticResource TextSecondary}" 
                                       HorizontalOptions="End"/>
                            </VerticalStackLayout>
                        </Frame>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
            <CollectionView.EmptyView>
                <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="20">
                    <Label Text="No notes yet" FontSize="20" TextColor="Gray" HorizontalOptions="Center"/>
                    <Button Text="Create your first note" 
                            Command="{Binding AddNoteCommand}" 
                            TextColor="{StaticResource TextPrimary}"
                            CornerRadius="20"
                            Padding="20,10"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>
        </CollectionView>
        
        <ImageButton Source="plus_circle.png"
                     Command="{Binding AddNoteCommand}"
                     HeightRequest="60"
                     WidthRequest="60"
                     HorizontalOptions="End"
                     VerticalOptions="End"
                     Margin="20"
                     Grid.Row="1"
                     CornerRadius="30"
                     BackgroundColor="#BB86FC"
                     Aspect="AspectFill"
                     IsVisible="False"/> <!-- Using ToolbarItem instead for simplicity, but keeping this as option -->
    </Grid>
</ContentPage>
